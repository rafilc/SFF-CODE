CAT

extends KinematicBody2D

var eating = false
var walking = true

var xdir = 1   # horizontal direction
var ydir = 1   # vertical direction
var speed = 20

var motion = Vector2()
var moving_vertical_horizontal = 1   # 1 = horizontal, 2 = vertical
onready var aud = $Area2D/AudioStreamPlayer2D


func _ready():
	# start timers
	randomize()
	$chagestatetimer.start()
	$walking.start()


func _physics_process(delta):
	if eating:
		# play eating animation
		$AnimatedSprite.play("eating")
		motion = Vector2()
	else:
		# play walking animation
		$AnimatedSprite.play("walking")

		# movement logic
		if moving_vertical_horizontal == 1:
			motion.x = speed * xdir
			motion.y = 0
			$AnimatedSprite.flip_h = xdir == -1
		elif moving_vertical_horizontal == 2:
			motion.y = speed * ydir
			motion.x = 0

	move_and_slide(motion)


func _on_chagestatetimer_timeout():
	# switch between walking and eating
	var waittime = 1

	if walking:
		eating = true
		walking = false
		waittime = rand_range(1, 5)
	else:
		eating = false
		walking = true
		waittime = rand_range(2, 6)

	$chagestatetimer.wait_time = waittime
	$chagestatetimer.start()


func _on_walking_timeout():
	# randomize direction if walking
	if walking:
		moving_vertical_horizontal = 1 if randf() > 0.5 else 2
		xdir = 1 if randf() > 0.5 else -1
		ydir = 1 if randf() > 0.5 else -1

	# restart timer
	$walking.wait_time = rand_range(1, 4)
	$walking.start()


func _on_Area2D_body_entered(body):
	if body.name ==  "player":
		aud.play()


func _on_Area2D_body_exited(body):
	if body.name == "player":
		aud.stop()
